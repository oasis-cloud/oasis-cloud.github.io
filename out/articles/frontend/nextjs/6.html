<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>[mini-next.js] çƒ­é‡è½½ï¼šå¼€å‘ä½“éªŒä¼˜åŒ–</title>
        <link rel="stylesheet" href="../../../assets/fonts.css">
        <link rel="stylesheet" href="../../../assets/graphite.css">
        <link rel="stylesheet" href="../../../assets/pygments.css">
        <script src="../../../assets/image-zoom.js" defer></script>
        
        
    </head>
    <body class="node-articles-frontend-nextjs-6 node-articles-frontend-nextjs node-articles-frontend node-articles node">
        <header class="masthead">
            <h1><a href="../../../index.html">Oasis's Cloud</a></h1>
            
                <p class="tagline">ä¸€ä¸ªäººçš„é¦–è¦è´£ä»»ï¼Œå°±æ˜¯è¦æœ‰é›„å¿ƒã€‚é›„å¿ƒæ˜¯ä¸€ç§é«˜å°šçš„æ¿€æƒ…ï¼Œå®ƒå¯ä»¥é‡‡å–å¤šç§åˆç†çš„å½¢å¼ã€‚<br />â€”â€” ã€Šä¸€ä¸ªæ•°å­¦å®¶çš„è¾©ç™½ã€‹</p>
            
            
            <nav class="menu">
                <input id="menu-check" type="checkbox"/>
                <label id="menu-label" for="menu-check" class="unselectable">
                    <span class="icon close-icon">âœ•</span>
                    <span class="icon open-icon">â˜°</span>
                    <span class="text">Menu</span>
                </label>
                <ul>
<li><a href="../../../index.html">é¦–é¡µ</a></li>
</ul>
            </nav>
        </header>
        <article class="main">
            <header class="title">
                <h1>[mini-next.js] çƒ­é‡è½½ï¼šå¼€å‘ä½“éªŒä¼˜åŒ–</h1>
                
                
                    <p class="author">ä½œè€…ï¼šoasis</p>
                
                <hr>
            </header>
            <h2>æ¦‚è¿°</h2>
<p>çƒ­é‡è½½ï¼ˆHot Reloadï¼‰æ˜¯ç°ä»£å‰ç«¯å¼€å‘å·¥å…·çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ã€‚å®ƒå…è®¸å¼€å‘è€…åœ¨ä¿®æ”¹ä»£ç åï¼Œæµè§ˆå™¨è‡ªåŠ¨åˆ·æ–°é¡µé¢ï¼Œæ— éœ€æ‰‹åŠ¨åˆ·æ–°ã€‚æœ¬æ–‡å°†æ·±å…¥åˆ†æå¹¶å®ç°çƒ­é‡è½½åŠŸèƒ½ã€‚</p>
<h2>æ ¸å¿ƒæ¦‚å¿µ</h2>
<h3>ä»€ä¹ˆæ˜¯çƒ­é‡è½½ï¼Ÿ</h3>
<p><strong>ä¼ ç»Ÿå¼€å‘æµç¨‹</strong>ï¼š
<div class="highlight"><pre><span></span><code>1. ä¿®æ”¹ä»£ç 
2. æ‰‹åŠ¨åˆ·æ–°æµè§ˆå™¨
3. æŸ¥çœ‹æ•ˆæœ
</code></pre></div></p>
<p><strong>çƒ­é‡è½½æµç¨‹</strong>ï¼š
<div class="highlight"><pre><span></span><code>1. ä¿®æ”¹ä»£ç 
2. æ–‡ä»¶ç›‘å¬å™¨æ£€æµ‹åˆ°å˜åŒ–
3. è‡ªåŠ¨é‡æ–°åŠ è½½
4. æµè§ˆå™¨è‡ªåŠ¨åˆ·æ–°ï¼ˆæˆ–é€šè¿‡ WebSocket é€šçŸ¥ï¼‰
</code></pre></div></p>
<h3>çƒ­é‡è½½çš„ä¼˜åŠ¿</h3>
<ol>
<li><strong>æé«˜å¼€å‘æ•ˆç‡</strong>ï¼šæ— éœ€æ‰‹åŠ¨åˆ·æ–°</li>
<li><strong>ä¿æŒçŠ¶æ€</strong>ï¼šæŸäº›æƒ…å†µä¸‹å¯ä»¥ä¿æŒåº”ç”¨çŠ¶æ€</li>
<li><strong>å³æ—¶åé¦ˆ</strong>ï¼šç«‹å³çœ‹åˆ°ä»£ç å˜åŒ–çš„æ•ˆæœ</li>
</ol>
<h2>åŠŸèƒ½åˆ†æ</h2>
<h3>1. æ–‡ä»¶ç³»ç»Ÿç›‘å¬</h3>
<p><strong>èŒè´£</strong>ï¼š
- ç›‘å¬ <code>pages</code> å’Œ <code>app</code> ç›®å½•çš„å˜åŒ–
- æ£€æµ‹æ–‡ä»¶åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤</p>
<p><strong>æŠ€æœ¯é€‰æ‹©</strong>ï¼š
- ä½¿ç”¨ <code>chokidar</code> åº“ï¼ˆè·¨å¹³å°æ–‡ä»¶ç›‘å¬ï¼‰</p>
<h3>2. æ¨¡å—ç¼“å­˜ç®¡ç†</h3>
<p><strong>èŒè´£</strong>ï¼š
- ç¼“å­˜å·²åŠ è½½çš„æ¨¡å—
- æ–‡ä»¶å˜åŒ–æ—¶æ¸…é™¤ç›¸å…³ç¼“å­˜
- é‡æ–°åŠ è½½æ¨¡å—</p>
<h3>3. è·¯ç”±é‡æ–°æ‰«æ</h3>
<p><strong>èŒè´£</strong>ï¼š
- æ–‡ä»¶å˜åŒ–æ—¶é‡æ–°æ‰«æè·¯ç”±
- æ›´æ–°è·¯ç”±æ˜ å°„è¡¨</p>
<h3>4. æµè§ˆå™¨é€šçŸ¥ï¼ˆç®€åŒ–ç‰ˆï¼‰</h3>
<p><strong>èŒè´£</strong>ï¼š
- é€šçŸ¥æµè§ˆå™¨åˆ·æ–°ï¼ˆç®€åŒ–å®ç°ï¼šä»…æ—¥å¿—è¾“å‡ºï¼‰
- çœŸå® Next.js ä½¿ç”¨ WebSocket</p>
<h2>é€æ­¥å®ç°</h2>
<h3>æ­¥éª¤ 1ï¼šå®ç°æ¨¡å—åŠ è½½å™¨</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// src/utils/module-loader.js</span>

<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">ModuleLoader</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Map</span><span class="p">();</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">watchFiles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Set</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">loadModule</span><span class="p">(</span><span class="nx">filePath</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// æ£€æŸ¥ç¼“å­˜</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">filePath</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">filePath</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="nx">filePath</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Module not found: </span><span class="si">${</span><span class="nx">filePath</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// åŠ¨æ€å¯¼å…¥æ¨¡å—</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="sb">`file://</span><span class="si">${</span><span class="nx">filePath</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="w">      </span><span class="c1">// è·å–é»˜è®¤å¯¼å‡ºæˆ–å‘½åå¯¼å‡º</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">module</span><span class="p">.</span><span class="k">default</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">module</span><span class="p">;</span>

<span class="w">      </span><span class="c1">// ç¼“å­˜æ¨¡å—</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">filePath</span><span class="p">,</span><span class="w"> </span><span class="nx">component</span><span class="p">);</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">watchFiles</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">filePath</span><span class="p">);</span>

<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">component</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`Error loading module </span><span class="si">${</span><span class="nx">filePath</span><span class="si">}</span><span class="sb">:`</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="nx">error</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">clearCache</span><span class="p">(</span><span class="nx">filePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filePath</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="nx">filePath</span><span class="p">);</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">watchFiles</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="nx">filePath</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">watchFiles</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">getWatchedFiles</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">watchFiles</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>å…³é”®ç‚¹</strong>ï¼š
- ä½¿ç”¨ <code>Map</code> ç¼“å­˜æ¨¡å—
- åŠ¨æ€å¯¼å…¥ä½¿ç”¨ <code>file://</code> åè®®
- æ”¯æŒæ¸…é™¤å•ä¸ªæˆ–å…¨éƒ¨ç¼“å­˜</p>
<h3>æ­¥éª¤ 2ï¼šå®ç°æ–‡ä»¶ç›‘å¬å™¨</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// src/server/dev-server.js</span>

<span class="k">import</span><span class="w"> </span><span class="nx">chokidar</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;chokidar&#39;</span><span class="p">;</span>

<span class="nx">_startWatcher</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">watchDirs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">useAppRouter</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">appDir</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">watchDirs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">appDir</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">usePagesRouter</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pagesDir</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">watchDirs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pagesDir</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">watchDirs</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">this</span><span class="p">.</span><span class="nx">watcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">chokidar</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="nx">watchDirs</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ignored</span><span class="o">:</span><span class="w"> </span><span class="sr">/node_modules/</span><span class="p">,</span>
<span class="w">    </span><span class="nx">persistent</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="k">this</span><span class="p">.</span><span class="nx">watcher</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">filePath</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`\nğŸ”„ æ–‡ä»¶å˜åŒ–: </span><span class="si">${</span><span class="nx">filePath</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// æ¸…é™¤ç›¸å…³æ¨¡å—ç¼“å­˜</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">moduleLoader</span><span class="p">.</span><span class="nx">clearCache</span><span class="p">(</span><span class="nx">filePath</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// é‡æ–°æ‰«æè·¯ç”±</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">useAppRouter</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">filePath</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">appDir</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">appRouter</span><span class="p">.</span><span class="nx">scanRoutes</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">usePagesRouter</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">filePath</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pagesDir</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">pagesRouter</span><span class="p">.</span><span class="nx">scanRoutes</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`âœ… å·²é‡æ–°åŠ è½½\n`</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="k">this</span><span class="p">.</span><span class="nx">watcher</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;add&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">filePath</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`\nâ• æ–°å¢æ–‡ä»¶: </span><span class="si">${</span><span class="nx">filePath</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">useAppRouter</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">filePath</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">appDir</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">appRouter</span><span class="p">.</span><span class="nx">scanRoutes</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">usePagesRouter</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">filePath</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pagesDir</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">pagesRouter</span><span class="p">.</span><span class="nx">scanRoutes</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`âœ… è·¯ç”±å·²æ›´æ–°\n`</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="k">this</span><span class="p">.</span><span class="nx">watcher</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;unlink&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">filePath</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`\nâ– åˆ é™¤æ–‡ä»¶: </span><span class="si">${</span><span class="nx">filePath</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">moduleLoader</span><span class="p">.</span><span class="nx">clearCache</span><span class="p">(</span><span class="nx">filePath</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">useAppRouter</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">filePath</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">appDir</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">appRouter</span><span class="p">.</span><span class="nx">scanRoutes</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">usePagesRouter</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">filePath</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pagesDir</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">pagesRouter</span><span class="p">.</span><span class="nx">scanRoutes</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`âœ… è·¯ç”±å·²æ›´æ–°\n`</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>å…³é”®ç‚¹</strong>ï¼š
- ç›‘å¬å¤šä¸ªç›®å½•ï¼ˆ<code>app</code> å’Œ <code>pages</code>ï¼‰
- å¿½ç•¥ <code>node_modules</code>
- å¤„ç†ä¸‰ç§äº‹ä»¶ï¼š<code>change</code>ã€<code>add</code>ã€<code>unlink</code>
- æ¸…é™¤ç¼“å­˜å¹¶é‡æ–°æ‰«æè·¯ç”±</p>
<h3>æ­¥éª¤ 3ï¼šåœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶å¯åŠ¨ç›‘å¬</h3>
<div class="highlight"><pre><span></span><code><span class="k">async</span><span class="w"> </span><span class="nx">start</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// ... å…¶ä»–åˆå§‹åŒ–ä»£ç  ...</span>

<span class="w">  </span><span class="c1">// å¯åŠ¨æ–‡ä»¶ç›‘å¬</span>
<span class="w">  </span><span class="k">this</span><span class="p">.</span><span class="nx">_startWatcher</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// ... å¯åŠ¨ HTTP æœåŠ¡å™¨ ...</span>
<span class="p">}</span>
</code></pre></div>
<h2>å®Œæ•´å®ç°</h2>
<h3>æ¨¡å—åŠ è½½å™¨</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// src/utils/module-loader.js</span>

<span class="k">import</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;fs&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">ModuleLoader</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Map</span><span class="p">();</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">watchFiles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Set</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">loadModule</span><span class="p">(</span><span class="nx">filePath</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">filePath</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">filePath</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="nx">filePath</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Module not found: </span><span class="si">${</span><span class="nx">filePath</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="sb">`file://</span><span class="si">${</span><span class="nx">filePath</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">module</span><span class="p">.</span><span class="k">default</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">module</span><span class="p">;</span>

<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">filePath</span><span class="p">,</span><span class="w"> </span><span class="nx">component</span><span class="p">);</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">watchFiles</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">filePath</span><span class="p">);</span>

<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">component</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`Error loading module </span><span class="si">${</span><span class="nx">filePath</span><span class="si">}</span><span class="sb">:`</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="nx">error</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">clearCache</span><span class="p">(</span><span class="nx">filePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">filePath</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="nx">filePath</span><span class="p">);</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">watchFiles</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="nx">filePath</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">watchFiles</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">getWatchedFiles</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">watchFiles</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3>æ–‡ä»¶ç›‘å¬å™¨é›†æˆ</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// src/server/dev-server.js</span>

<span class="k">import</span><span class="w"> </span><span class="nx">chokidar</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;chokidar&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">DevServer</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// ... å…¶ä»–ä»£ç  ...</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">start</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ... åˆå§‹åŒ–ä»£ç  ...</span>

<span class="w">    </span><span class="c1">// å¯åŠ¨æ–‡ä»¶ç›‘å¬</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">_startWatcher</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// ... å¯åŠ¨æœåŠ¡å™¨ ...</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">_startWatcher</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">watchDirs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">useAppRouter</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">appDir</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">watchDirs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">appDir</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">usePagesRouter</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pagesDir</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">watchDirs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pagesDir</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">watchDirs</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">watcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">chokidar</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="nx">watchDirs</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">ignored</span><span class="o">:</span><span class="w"> </span><span class="sr">/node_modules/</span><span class="p">,</span>
<span class="w">      </span><span class="nx">persistent</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">watcher</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">filePath</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`\nğŸ”„ æ–‡ä»¶å˜åŒ–: </span><span class="si">${</span><span class="nx">filePath</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">moduleLoader</span><span class="p">.</span><span class="nx">clearCache</span><span class="p">(</span><span class="nx">filePath</span><span class="p">);</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">useAppRouter</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">filePath</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">appDir</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">appRouter</span><span class="p">.</span><span class="nx">scanRoutes</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">usePagesRouter</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">filePath</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pagesDir</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">pagesRouter</span><span class="p">.</span><span class="nx">scanRoutes</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`âœ… å·²é‡æ–°åŠ è½½\n`</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">watcher</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;add&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">filePath</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`\nâ• æ–°å¢æ–‡ä»¶: </span><span class="si">${</span><span class="nx">filePath</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">useAppRouter</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">filePath</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">appDir</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">appRouter</span><span class="p">.</span><span class="nx">scanRoutes</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">usePagesRouter</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">filePath</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pagesDir</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">pagesRouter</span><span class="p">.</span><span class="nx">scanRoutes</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`âœ… è·¯ç”±å·²æ›´æ–°\n`</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">watcher</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;unlink&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">filePath</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`\nâ– åˆ é™¤æ–‡ä»¶: </span><span class="si">${</span><span class="nx">filePath</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">moduleLoader</span><span class="p">.</span><span class="nx">clearCache</span><span class="p">(</span><span class="nx">filePath</span><span class="p">);</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">useAppRouter</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">filePath</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">appDir</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">appRouter</span><span class="p">.</span><span class="nx">scanRoutes</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">usePagesRouter</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">filePath</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pagesDir</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">pagesRouter</span><span class="p">.</span><span class="nx">scanRoutes</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`âœ… è·¯ç”±å·²æ›´æ–°\n`</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">stop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">watcher</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">watcher</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2>å·¥ä½œæµç¨‹</h2>
<h3>æ–‡ä»¶ä¿®æ”¹æµç¨‹</h3>
<div class="highlight"><pre><span></span><code>1. å¼€å‘è€…ä¿®æ”¹ pages/about.js
   â†“
2. chokidar æ£€æµ‹åˆ°æ–‡ä»¶å˜åŒ–
   â†“
3. è§¦å‘ &#39;change&#39; äº‹ä»¶
   â†“
4. æ¸…é™¤æ¨¡å—ç¼“å­˜ï¼ˆabout.jsï¼‰
   â†“
5. é‡æ–°æ‰«æè·¯ç”±ï¼ˆå¦‚æœæœ‰ç»“æ„å˜åŒ–ï¼‰
   â†“
6. ä¸‹æ¬¡è¯·æ±‚æ—¶é‡æ–°åŠ è½½æ¨¡å—
</code></pre></div>
<h3>æ–°å¢æ–‡ä»¶æµç¨‹</h3>
<div class="highlight"><pre><span></span><code>1. å¼€å‘è€…åˆ›å»º pages/new-page.js
   â†“
2. chokidar æ£€æµ‹åˆ°æ–°æ–‡ä»¶
   â†“
3. è§¦å‘ &#39;add&#39; äº‹ä»¶
   â†“
4. é‡æ–°æ‰«æè·¯ç”±
   â†“
5. æ–°è·¯ç”±ç«‹å³å¯ç”¨
</code></pre></div>
<h3>åˆ é™¤æ–‡ä»¶æµç¨‹</h3>
<div class="highlight"><pre><span></span><code>1. å¼€å‘è€…åˆ é™¤ pages/old-page.js
   â†“
2. chokidar æ£€æµ‹åˆ°æ–‡ä»¶åˆ é™¤
   â†“
3. è§¦å‘ &#39;unlink&#39; äº‹ä»¶
   â†“
4. æ¸…é™¤æ¨¡å—ç¼“å­˜
   â†“
5. é‡æ–°æ‰«æè·¯ç”±
   â†“
6. è·¯ç”±ä»æ˜ å°„è¡¨ä¸­ç§»é™¤
</code></pre></div>
<h2>ä¸çœŸå® Next.js çš„å·®å¼‚</h2>
<h3>å·²å®ç°</h3>
<ul>
<li>âœ… æ–‡ä»¶ç³»ç»Ÿç›‘å¬</li>
<li>âœ… æ¨¡å—ç¼“å­˜æ¸…é™¤</li>
<li>âœ… è·¯ç”±é‡æ–°æ‰«æ</li>
</ul>
<h3>æœªå®ç°ï¼ˆç®€åŒ–ï¼‰</h3>
<ul>
<li>âŒ <strong>WebSocket é€šçŸ¥</strong>ï¼šçœŸå® Next.js é€šè¿‡ WebSocket é€šçŸ¥æµè§ˆå™¨åˆ·æ–°</li>
<li>âŒ <strong>å¢é‡æ›´æ–°</strong>ï¼šåªæ›´æ–°å˜åŒ–çš„éƒ¨åˆ†</li>
<li>âŒ <strong>çŠ¶æ€ä¿æŒ</strong>ï¼šæŸäº›æƒ…å†µä¸‹ä¿æŒåº”ç”¨çŠ¶æ€</li>
<li>âŒ <strong>é”™è¯¯æ¢å¤</strong>ï¼šè‡ªåŠ¨æ¢å¤ç¼–è¯‘é”™è¯¯</li>
</ul>
<h2>ä½¿ç”¨ç¤ºä¾‹</h2>
<h3>å¯åŠ¨å¼€å‘æœåŠ¡å™¨</h3>
<div class="highlight"><pre><span></span><code>npm<span class="w"> </span>run<span class="w"> </span>dev
</code></pre></div>
<h3>ä¿®æ”¹æ–‡ä»¶</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// pages/about.js</span>
<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">About</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">About</span><span class="w"> </span><span class="nx">Page</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">Updated</span><span class="o">!&lt;</span><span class="err">/h1&gt;;</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>æ§åˆ¶å°è¾“å‡º</strong>ï¼š
<div class="highlight"><pre><span></span><code>ğŸ”„ æ–‡ä»¶å˜åŒ–: /path/to/pages/about.js
âœ… å·²é‡æ–°åŠ è½½
</code></pre></div></p>
<h3>åˆ·æ–°æµè§ˆå™¨</h3>
<p>è®¿é—®é¡µé¢æ—¶ï¼Œä¼šä½¿ç”¨æ–°åŠ è½½çš„æ¨¡å—ï¼Œæ˜¾ç¤ºæ›´æ–°åçš„å†…å®¹ã€‚</p>
<h2>æ€»ç»“</h2>
<p>çƒ­é‡è½½çš„æ ¸å¿ƒæ˜¯<strong>æ–‡ä»¶ç›‘å¬å’Œæ¨¡å—ç¼“å­˜ç®¡ç†</strong>ï¼š</p>
<ol>
<li><strong>æ–‡ä»¶ç›‘å¬</strong>ï¼šä½¿ç”¨ <code>chokidar</code> ç›‘å¬æ–‡ä»¶ç³»ç»Ÿå˜åŒ–</li>
<li><strong>ç¼“å­˜æ¸…é™¤</strong>ï¼šæ–‡ä»¶å˜åŒ–æ—¶æ¸…é™¤ç›¸å…³æ¨¡å—ç¼“å­˜</li>
<li><strong>è·¯ç”±æ›´æ–°</strong>ï¼šé‡æ–°æ‰«æè·¯ç”±ä»¥åæ˜ æ–‡ä»¶ç»“æ„å˜åŒ–</li>
<li><strong>è‡ªåŠ¨é‡è½½</strong>ï¼šä¸‹æ¬¡è¯·æ±‚æ—¶ä½¿ç”¨æ–°ä»£ç </li>
</ol>
<p>è¿™ä¸ªå®ç°è™½ç„¶ç®€åŒ–ï¼Œä½†åŒ…å«äº†çƒ­é‡è½½çš„æ ¸å¿ƒé€»è¾‘ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¼€å‘è€…ä¿®æ”¹ä»£ç åï¼ŒæœåŠ¡å™¨ä¼šè‡ªåŠ¨æ£€æµ‹å˜åŒ–å¹¶é‡æ–°åŠ è½½ï¼Œå¤§å¤§æé«˜äº†å¼€å‘æ•ˆç‡ã€‚</p>
<hr />
<p><strong>ç›¸å…³æ–‡ä»¶</strong>ï¼š
- <code>src/utils/module-loader.js</code> - æ¨¡å—åŠ è½½å™¨å®ç°
- <code>src/server/dev-server.js</code> - æ–‡ä»¶ç›‘å¬å™¨é›†æˆ
- <code>package.json</code> - chokidar ä¾èµ–</p>
        </article>
        
        <script src="https://giscus.app/client.js"
                data-repo="oasis-cloud/blog-comments"
                data-repo-id="R_kgDOKEliHA"
                data-category="General"
                data-category-id="DIC_kwDOKEliHM4CYb6e"
                data-mapping="pathname"
                data-strict="0"
                data-reactions-enabled="1"
                data-emit-metadata="0"
                data-input-position="bottom"
                data-theme="preferred_color_scheme"
                data-lang="zh-CN"
                crossorigin="anonymous"
                async>
        </script>
    </body>
</html>
